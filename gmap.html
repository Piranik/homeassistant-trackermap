<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
</head>
<script src="js/d3.v4.min.js"></script>
<style>
    html, body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
      }
    #map {
        height: 100%;
        width: 100%;
        margin-right: 10px;
    }

    #date,
    #date2 {
        background-color: #ffecb3;
        margin-top: 3px;
    }

    #floating-panel {
        position: relative;
        left: 0px;
        padding: 0px;
        border-bottom: 1px solid #999;
        text-align: center;
        font-family: 'Roboto', 'sans-serif';
        line-height: 10px;
        background-color: #fff;
        z-index: 5;
    }

    ::-webkit-datetime-edit-day-field {
        color: red;
    }
</style>
<script>
    function initMap() {

        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10,
            gestureHandling: 'greedy',
            disableDefaultUI: true,
            center: {
                lat: 52.848351,
                lng: 4.738365
            }, 
        });
        poly = new google.maps.Polyline({
            strokeColor: 'red',
            strokeOpacity: 0.5,
            strokeWeight: 2
        });
        poly.setMap(map);

        heatmapData = new google.maps.MVCArray();
        heatmap = new google.maps.visualization.HeatmapLayer({
            geodesic: false,
            clickable: false,
            data: heatmapData,
            radius: 30,
            opacity: 0.7,
            maxIntensity: 10
        });
    }

    function toggleHeatmap() {
        heatmap.setMap(heatmap.getMap() ? null : map);
        poly.setMap(poly.getMap() ? null : map);
    } 

    function changeupRadius() {
        heatmap.set('radius', heatmap.get('radius') * 1.05);
    }

    function changedownRadius() {
        heatmap.set('radius', heatmap.get('radius') / 1.05);
    }

    function changeupInt() {
        heatmap.set('maxIntensity', heatmap.get('maxIntensity') / 1.05);
    }

    function changedownInt() {
        heatmap.set('maxIntensity', heatmap.get('maxIntensity') * 1.05);
    }

    function changeOpacity() {
        heatmap.set('opacity', heatmap.get('opacity') ? null : 0.8);
    }
    function changeGradient() {
        var gradient = [
          'rgba(0, 255, 255, 0)',
          'rgba(0, 255, 255, 1)',
          'rgba(0, 191, 255, 1)',
          'rgba(0, 127, 255, 1)',
          'rgba(0, 63, 255, 1)',
          'rgba(0, 0, 255, 1)',
          'rgba(0, 0, 223, 1)',
          'rgba(0, 0, 191, 1)',
          'rgba(0, 0, 159, 1)',
          'rgba(0, 0, 127, 1)',
          'rgba(63, 0, 91, 1)',
          'rgba(127, 0, 63, 1)',
          'rgba(191, 0, 31, 1)',
          'rgba(255, 0, 0, 1)'
        ]
        heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
    }
    var myVar = setInterval(addLatLng, 700);
    var myVar1 = setInterval(addLatLng, 100000);
    var myVar2 = setInterval(today, 100);

    function addLatLng(event) {


        var URLMarker = document.getElementById("marker").value

        var URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQNMeBImcHdirQATlHASi75L0ovieBMbc_gr_E0ZZnO4We7Sn-m76BNCgkJhk262J2z9rANEpueBwEO/pub?gid=0&single=true&output=csv';

        d3.csv(URL, function(error, data) {
            csv = data.filter(function(row) {
                return (row['Date'] >= document.getElementById("date").value && row['Date'] <= document.getElementById("date2").value);
            });

            var bounds = new google.maps.LatLngBounds();
            var location2 = [];
            csv.forEach(function(d) {

                var location = new google.maps.LatLng(d.Lat, d.Long);

                path.push(location);
                heatmapData.push(location);
                var marker = new google.maps.Marker({
                    position: location,
                    map: map,
                    title: d.Title,
                    icon: URLMarker,
                });
                bounds.extend(location);
                map.fitBounds(bounds);
                marker.infowindow = new google.maps.InfoWindow({
                    content: d.Title
                });
                marker.addListener('click', function() {
                    this.infowindow.open(map, this);
                });
            });
        });
        clearInterval(myVar);
        var path = poly.getPath();
    }
    function today() {
        document.getElementById('date').valueAsDate = new Date();
        document.getElementById('date2').valueAsDate = new Date();
        clearInterval(myVar2);
    }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXu3BoAwbEF8w27rTSIAs-l183ACb3v_M&libraries=visualization&callback=initMap">
</script>
<div id="floating-panel">
    <select id="marker" onChange="initMap(), addLatLng()">
    <option selected disabled value="pin.png">Markers</option>
    <option value="pin.png">Yes</option>
    <option value="0">No</option>
</select>
        <button onclick="toggleHeatmap()">Toggle Heatmap</button></br>
        <button onclick="changeupRadius()">▲ Radius</button>
        <button onclick="changedownRadius()">▼ Radius</button>
        <button onclick="changeupInt()">▲ Int</button>
        <button onclick="changedownInt()">▼ Int</button>
        <button onclick="changeGradient()">Color</button>
        <button onclick="changeOpacity()">Opacity</button>
    <br>
    <input id="date" type="date" onChange="initMap(), addLatLng()">
    <input id="date2" type="date" onChange="initMap(), addLatLng()">
    <input type="button" value="Today" onClick="today(),initMap(), addLatLng()"></div>
<div id="map"></div>
</html>